function Cell(){this.n=1,this.s=1,this.e=1,this.w=1,this.row=null,this.col=null,this.x=null,this.y=null}function main(){document.onkeydown=process_key_down,document.onkeyup=process_key_up,generateMap(),game=setInterval(function(){draw(),update()},30),intro=setInterval(function(){generateMap()},60)}function generateMap(){var e=[];initialize(e);var l=[],a=rows*cols-1,r=map[rows-1][cols-1];exit=[r.row,r.col],e[r.row][r.col]=!1;for(var o=1;a>=o;){var p=getNeighbors(r,e);if(p.length>0){var y=p[Math.floor(Math.random()*p.length)];clearWalls(r,y),l.push(r),r=y,e[r.row][r.col]=!1,o+=1}else l.pop(),r=l[l.length-1]}}function initialize(e){for(var l=0,a=0,r=0;rows>r;r++){map[r]=[],e[r]=[];for(var o=0;cols>o;o++)map[r][o]=new Cell,map[r][o].row=r,map[r][o].col=o,map[r][o].x=l,map[r][o].y=a,l+=floorSize,e[r][o]=!0;a+=floorSize,l=0}}function getNeighbors(e,l){var a=[],r=e.row,o=e.col;return 0!=r&&l[r-1][o]&&a.push(map[r-1][o]),r!=rows-1&&l[r+1][o]&&a.push(map[r+1][o]),0!=o&&l[r][o-1]&&a.push(map[r][o-1]),o!=cols-1&&l[r][o+1]&&a.push(map[r][o+1]),a}function clearWalls(e,l){l.row<e.row?(l.s=0,e.n=0):l.row>e.row?(l.n=0,e.s=0):l.col<e.col?(l.e=0,e.w=0):(l.w=0,e.e=0)}function draw(){ctx.clearRect(0,0,WIDTH,HEIGHT),ctx.fillStyle="#FFFFFF",ctx.fillStyle="#000000",ctx.fillRect(player.x,player.y,player.size,player.size);for(var e=0;rows>e;e++)for(var l=0;cols>l;l++)e==exit[0]&&l==exit[1]&&(ctx.fillStyle="#FF0000",ctx.fillRect(map[e][l].x,map[e][l].y,floorSize,floorSize)),ctx.fillStyle="#000000",map[e][l].n&&ctx.fillRect(map[e][l].x,map[e][l].y,floorSize,wallSize),map[e][l].s&&ctx.fillRect(map[e][l].x,map[e][l].y+floorSize,floorSize,wallSize),map[e][l].e&&ctx.fillRect(map[e][l].x+floorSize,map[e][l].y,wallSize,floorSize),map[e][l].w&&ctx.fillRect(map[e][l].x,map[e][l].y,wallSize,floorSize)}function process_key_down(e){e=e||window.event,"87"==e.keyCode?player.velY=-player.speed:"83"==e.keyCode?player.velY=player.speed:"68"==e.keyCode?player.velX=player.speed:"65"==e.keyCode&&(player.velX=-player.speed),window.clearInterval(intro)}function process_key_up(e){e=e||window.event,"87"==e.keyCode||"83"==e.keyCode?player.velY=0:("68"==e.keyCode||"65"==e.keyCode)&&(player.velX=0)}function update(){if(0==player.velX||0==player.velY){var e=Math.floor(player.y/floorSize),l=Math.floor((player.y+player.size)/floorSize),a=Math.floor(player.x/floorSize),r=Math.floor((player.x+player.size)/floorSize);player.x+=player.velX,player.x<0||player.x>WIDTH-player.size?player.x-=player.velX:player.velX>0?(a=Math.floor((player.x-player.speed)/floorSize),map[e][a].e||map[l][a].e?player.x-=player.velX:horizontalWall(e,l,a)&&(player.x-=player.velX),a=Math.floor(player.x/floorSize)):player.velX<0&&(r=Math.floor((player.x+floorSize)/floorSize),map[e][r].w||map[l][r].w?player.x-=player.velX:horizontalWall(e,l,r)&&(player.x-=player.velX),r=Math.floor((player.x+floorSize-player.speed)/floorSize)),player.y+=player.velY,player.y<0||player.y>HEIGHT-2*player.size?player.y-=player.velY:player.velY>0?(l=Math.floor((player.y+floorSize-player.speed)/floorSize),map[l][a].n||map[l][r].n?player.y-=player.velY:verticalWall(a,r,l)&&(player.y-=player.velY)):player.velY<0&&(e=Math.floor(player.y/floorSize),map[e][a].s||map[e][r].s?player.y-=player.velY:verticalWall(a,r,e)&&(player.y-=player.velY));var o=Math.floor(player.y/floorSize),p=Math.floor(player.x/floorSize);o==exit[0]&&p==exit[1]&&end()}}function horizontalWall(e,l,a){return map[l][a].y>player.y&&map[l][a].y<player.y+floorSize||map[e][a].y>player.y&&map[e][a].y<player.y+floorSize}function verticalWall(e,l,a){return map[a][l].x>player.x&&map[a][l].x<player.x+floorSize||map[a][e].x>player.x&&map[a][e].x<player.x+floorSize}function end(){window.clearInterval(game),alert("Congrats")}var floorSize=10,wallSize=1,player={size:floorSize-1,speed:5,x:0,y:0,velX:0,velY:0},ctx=document.getElementById("game").getContext("2d");ctx.canvas.width=Math.round((window.innerWidth-2*floorSize)/floorSize)*floorSize+wallSize;var WIDTH=ctx.canvas.width-wallSize,HEIGHT=ctx.canvas.height-wallSize,rows=Math.floor(HEIGHT/floorSize),cols=Math.floor(WIDTH/floorSize),map=new Array(rows),exit=null,game=null,intro=null;
